<app-loader *ngIf="isLoading"></app-loader>

<div class="layout">
  <div class="btn-container">
    <button class="search-btn" matTooltip="Filters" mat-flat-button (click)="openSearch()">
      <mat-icon color="primary">search</mat-icon>
    </button>

    <button mat-raised-button color="primary" class="add-contact-btn" (click)="openContactDrawer()">
      <mat-icon> contacts</mat-icon>
      ADD CONTACT</button>
  </div>

  <mat-drawer-container class="drawer-container" autosize>
    <mat-drawer #drawer class="drawer" mode="side">
      <form class="form-container" [formGroup]="contactFormGroup">
        <span class="menu-type">{{menuType}} CONTACT</span>
        <div class="form-fields-container">
          <mat-form-field>
            <mat-label>Name</mat-label>
            <input type="text" matInput [formControlName]="'name'" maxlength="150">
            <mat-icon matSuffix>person</mat-icon>
            <mat-error *ngIf="contactFormGroup.hasError('required') || contactFormGroup.get('name').touched">
              Name is <strong>required</strong>
            </mat-error>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Phone</mat-label>
            <input type="tel" matInput [formControlName]="'phone'" maxlength="15">
            <mat-icon matSuffix>phone</mat-icon>
            <mat-error *ngIf="contactFormGroup.get('phone').hasError('pattern') ">
              Please enter a valid telephone number
            </mat-error>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Email</mat-label>
            <input type="tel" matInput [formControlName]="'email'">
            <mat-icon matSuffix>email</mat-icon>
            <mat-error *ngIf="contactFormGroup.get('email').hasError('pattern')">
              Please enter a valid email address
            </mat-error>
            <mat-error *ngIf="contactFormGroup.hasError('required')">
              Email is <strong>required</strong>
            </mat-error>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Company</mat-label>
            <input type="text" matInput [spellcheck]="false" [formControlName]="'company'" maxlength="150">
          </mat-form-field>

          <mat-form-field>
            <mat-label>Department</mat-label>
            <input type="text" matInput [spellcheck]="false" [formControlName]="'department'" maxlength="150">
          </mat-form-field>

          <mat-form-field>
            <mat-label>Address</mat-label>
            <input type="text" matInput [spellcheck]="false" [formControlName]="'address'" maxlength="150">
          </mat-form-field>

          <mat-form-field>
            <mat-label>Note</mat-label>
            <textarea matInput [rows]="2" [spellcheck]="false" matTextareaAutosize [formControlName]="'note'" maxlength="1500"></textarea>
            <mat-icon matSuffix>note</mat-icon>
          </mat-form-field>

          <!-- <mat-form-field>
            <mat-label>Type</mat-label>
            <mat-select [formControlName]="'type'">
              <mat-option *ngFor="let type of typeData" [value]="type.code">
                {{type.label}}
              </mat-option>
            </mat-select>
          </mat-form-field> -->
        </div>

        <div class="btn-container">
          <button mat-button type="reset" (click)="closeDrawer('contactForm')">Cancel</button>
          <button mat-flat-button [color]="'primary'" type="button" (click)="saveContact()">Save</button>
        </div>
      </form>
    </mat-drawer>

    <div class="sidenav-content" [ngClass]="{'custom-action-mode': isActionMode}">
      <table mat-table [dataSource]="contactsDataSource" class="mat-elevation-z8">
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>
            Name
          </th>
          <td mat-cell *matCellDef="let contact">
            <span>
              {{contact.name }}
            </span>
          </td>
        </ng-container>
        <ng-container matColumnDef="phone">
          <th mat-header-cell *matHeaderCellDef>
            Phone
          </th>
          <td mat-cell *matCellDef="let contact">
            <span>
              {{contact.phone }}
            </span>
          </td>
        </ng-container>
        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef class="custom-w">
            Email
          </th>
          <td mat-cell *matCellDef="let contact" class="custom-w">
            <span>
              {{contact.email }}
            </span>
          </td>
        </ng-container>
        <ng-container matColumnDef="department">
          <th mat-header-cell *matHeaderCellDef>
            Department
          </th>
          <td mat-cell *matCellDef="let contact">
            <span>
              {{contact.department }}
            </span>
          </td>
        </ng-container>
        <ng-container matColumnDef="company">
          <th mat-header-cell *matHeaderCellDef class="custom-w">
            Company
          </th>
          <td mat-cell *matCellDef="let contact" class="custom-w">
            <span>
              {{contact.company }}
            </span>
          </td>
        </ng-container>
        <ng-container matColumnDef="address">
          <th mat-header-cell *matHeaderCellDef class="custom-w">
            Address
          </th>
          <td mat-cell *matCellDef="let contact" class="custom-w">
            <span>
              {{contact.address }}
            </span>
          </td>
        </ng-container>
        <ng-container matColumnDef="note">
          <th mat-header-cell *matHeaderCellDef class="custom-w-note">
            Note
          </th>
          <td mat-cell *matCellDef="let contact" class="custom-w-note">
            <span *ngIf="contact.note">
              <mat-icon matTooltip='{{contact.note }}'>info</mat-icon>
            </span>
          </td>
        </ng-container>
        <ng-container matColumnDef="button">
          <th mat-header-cell *matHeaderCellDef class="custom-w-note">
          </th>
          <td mat-cell *matCellDef="let contact" class="custom-w-note">
            <div class="edit-btn-container flex flex-row items-center justify-end">
              <button matTooltip="Edit contact" class="" mat-flat-button (click)="editContact(contact)">
                <mat-icon [color]="'primary'">edit</mat-icon>
              </button>
              <button class="" matTooltip="Delete contact" mat-flat-button (click)="deleteContact(contact)">
                <mat-icon [color]="'warn'">delete</mat-icon>
              </button>
            </div>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let contact; columns: displayedColumns;"></tr>
      </table>
      <mat-paginator [pageSizeOptions]="[10, 20, 50]" showFirstLastButtons [pageSize]="pageSize || 10" [length]="tableSize"
        (page)="getContactsData()">
      </mat-paginator>
    </div>

  </mat-drawer-container>
  <span *ngIf="!(contactsDataSource && contactsDataSource.data && contactsDataSource.data.length)">Няма намерени
    резултати</span>
</div>
